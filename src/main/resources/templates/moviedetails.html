<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:inline="javascript">

<head>
	<meta charset="UTF-8" />
	<title>電影資訊</title>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

	<!-- FontAwesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
	<link href="/css/sb-admin-2.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="/css/index2.css" />
	<link rel="stylesheet" href="/css/footer.css" />

	<style>
		body {
			padding-top: 80px;
		}

		.navbar .nav-link {
			font-size: 16px;
			font-weight: 600;
		}

		h2#name {
			margin-top: 20px;
			margin-bottom: 60px;
		}
	</style>
</head>

<body th:data-loggedin="${session.memberDetail != null}">
	<!-- Navbar -->
	<th:block th:replace="~{fragments/navbar :: navbar}"></th:block>

	<!-- 主內容 -->
	<div class="container">
		<div class="movie-container mt-4"></div>

		<!-- 關於電影院 -->
		<section class="carbon dark">
			<div class="content">
				<h2>光影之門電影院</h2>
				<p>光影之門電影院，創立於 2001 年，致力於打造沉浸式觀影體驗，讓光影交織夢想，為每一位觀眾呈現極致視聽盛宴。</p>
				<a href="#" class="btn">了解我們 <i class="fas fa-chevron-right"></i></a>
			</div>
		</section>

		<!-- 社群連結 -->
		<section class="follow">
			<p>Follow Us</p>
			<a href="https://facebook.com"><img src="/imgs/social-fb.png" alt="Facebook" /></a>
			<a href="https://twitter.com"><img src="/imgs/social-twitter.png" alt="Twitter" /></a>
			<a href="https://linkedin.com"><img src="/imgs/social-linkedin.png" alt="Linkedin" /></a>
		</section>

		<!-- 聊天 Modal -->
		<div th:if="${session.memberName != null}">
			<div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">即時客服對話</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<div id="chat-box"
								style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>
							<input id="from" class="form-control mt-2" readonly th:value="${session.memberName}" />
							<input id="message" class="form-control mt-2" placeholder="輸入訊息" />
							<button onclick="sendMessage()" class="btn btn-primary mt-2">送出</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 登入 Modal -->
	<th:block th:replace="~{fragments/loginPage :: login}"></th:block>

	<!-- Footer -->
	<th:block th:replace="~{fragments/footer :: footer}"></th:block>

	<!-- JavaScript 區塊 -->
	<script src="/js/jquery.js"></script>
	<script src="/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="/js/sb-admin-2.min.js"></script>

	<!-- 用 Thymeleaf 注入 movieId -->
	<script th:inline="javascript">
		/*<![CDATA[*/
		let movieId = /*[[${movieid}]]*/ 0;
		/*]]>*/
	</script>

	<!-- AJAX 取得電影資料 -->
	<script>
		$(document).ready(function () {
			$.ajax({
				url: '/movies/MovieInfo/' + movieId,
				method: 'GET',
				success: function (movie) {
					console.log(movie);
					$('.movie-container').append(`
						<div class="row mb-5">
							<div class="col-md-4">
								<img src="/movie/images/${movie.image}" alt="${movie.name}" class="img-fluid rounded shadow">
							</div>
							<div class="col-md-8 text-white">
								<h2 id="name">${movie.name} <small class="text-white"></small></h2>
								<p><strong>評級：</strong>${movie.rating} </p>
								<p><strong>片長：</strong>${movie.runtime} 分鐘</p>
								<p><strong>上映日：</strong>${movie.released}</p>
								<p><strong>類型：</strong>${movie.genre}</p>
								<p><strong>演員：</strong>${movie.actor}</p>
								<p><strong>導演：</strong>${movie.director}</p>
								<p><strong>簡介：</strong><br>${movie.description}</p>
							</div>
						</div>
					`);

				}
			});
		});
	</script>

	<!-- 登出提示 -->
	<script th:if="${logoutSuccess}">
		Swal.fire({
			icon: "success",
			title: "登出成功",
			text: "您已成功登出！",
			confirmButtonText: "確認",
			timer: 3000,
			timerProgressBar: true,
		});
	</script>

	<!-- 其他 -->
	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
	<script src="/js/loginPage.js"></script>
	<script src="/js/carousel.js"></script>
	<script src="/js/chat.js"></script>
</body>

</html>